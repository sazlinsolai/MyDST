<% content_for :page do %>
<div data-role="page" data-url="/patients/<%=@patient.id%>" data-context='{"url":"/patients", "panel":"menu", "refresh":"true"}' >

  <%= render :partial => 'layouts/page_header', :locals => {:title => "#{@patient.name}", :location => "main" } %>

  <div data-role="content">

<% @location = "main" %>


<div class="row">
  <div class="span6">
    <h2>Maklumat Pesakit : <b><%= @patient.name if @patient.name? %></b> </h2>
  </div>
  <div class="last">
    <div class='leftupperbutton' data-role="controlgroup" data-type="horizontal">
        <!--<a href="<%= new_patient_path %>" data-role="button" data-icon="plus" data-theme="c"><span style="color:green;">Pesakit Baru</span></a> -->
        <!--<a href="#" data-role="button" data-icon="check" data-theme="c"><span style="color:green;">Edit Rekod</span></a>-->
        <a href="#" data-role="button" data-icon="delete" data-theme="c"><span style="color:red;">Hapus Rekod</span></a>
        
        
        <%#= button_to "Hapus Rekod", patient_path(@patient) , :method => :delete, 'data-icon'=>"delete" %>
    </div>
  </div>
</div>
  
<hr>


<!--  using class row and sixcol will create double column inside the main panel which consist of 12 column -->
<div class="row">
  <div class="span6">
    <table width="400">
      <tr>
        <td width="50%" align="right">Tarikh Pendaftaran Pesakit : </td>
        <td><%= @patient.registration_date.strftime('%d/%m/%Y') if @patient.registration_date?%></td>
      </tr>
      <tr>
        <td width="50%" align="right">No Fail Pesakit :</td>
        <td><%= @patient.file_no if @patient.file_no?%> </td>
      </tr>
      <tr>
        <td width="50%" align="right">No KP Baru :</td>
        <td><%= @patient.ic_no if @patient.ic_no? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Tarikh Lahir : </td>
        <td><%= @patient.birthdate.strftime('%d/%m/%Y') if @patient.birthdate? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Umur Pesakit : </td>
        <td><%= @patient.age if @patient.age? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Kategori Pekerjaan : </td>
        <td><%= @patient.work_category if @patient.work_category? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Pindah : </td>
        <td><%= @patient.transfer if @patient.transfer? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">No KP Lama/Tentera/Polis : </td>
        <td><%= @patient.old_ic if @patient.old_ic? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Bangsa : </td>
        <td><%= @patient.race if @patient.race? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Nama Pekerjaan : </td>
        <td><%= @patient.occupation if @patient.occupation? %></td>
      </tr>
    </table>
 
  </div>
  <div class="last">
    <p><%= image_tag @patient.avatar.url(:thumb) %></p>
    <p>Status Pesakit : <%= @patient.status %> </p>
    

  </div>
</div>

<hr>

<div class="row">
  <div class="span6">
    <h2>Alamat Pesakit </h2>
  </div>
  <div class="span6 last">
    <h2>Pengdispensan </h2>
  </div>
  
</div>
<div class="row">
  <div class="span6">
    <table width="400">
      <tr>
        <td width="50%" align="right">Alamat : </td>
        <td><%= @patient.address if @patient.address? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Bandar : </td>
        <td><%= @patient.daerah if @patient.daerah? %></td>
      </tr>
      <tr>
        <td width="50%" align="right">Poskod : </td>
        <td><%= @patient.postcode if @patient.postcode?%></td>
      </tr>
      <tr>
        <td width="50%" align="right">Negeri : </td>
        <td><%= patient_country(@patient.state_id) if @patient.state_id? %></td>
      </tr>
      
    </table>
   
  </div>

  <div class="span6 last">

    <% if @prescription.empty?  %> <!-- start check if no prescription for this patient -->
      <p>tiada preskripsi.sila buat temujanji dengan doktor terlebih dahulu</p>
      <%= link_to 'New Prescription', new_prescription_path(:patient_id => @patient.id), 'data-role'=>"button"%>

    <% elsif @prescription[0].dispense_profiles.dispensing_day(@prescription[0].id).empty? %>
      <p>tiada dispensan dijadualkan untuk hari ini</p>
    <% else %>
      <table>
      <tr>
        <td align="right">Tarikh Tamat Preskripsi :</td>
        <td><%= @prescription[0].prescription_due_date.strftime("%d/%m/%Y") %> </td>
      </tr>
      <tr>
        <td align="right">Tarikh Mula Preskripsi :</td>
        <td><%= @prescription[0].date_of_prescription.strftime("%d/%m/%Y") %></td>
      </tr>
      <tr>
        <td align="right">Dos :</td>
        <td><%= @prescription[0].medicine_dose %> <%= @prescription[0].uom %></td>
      </tr>
      <tr>
        <td align="right">Jenis Pengdispensan :</td>
        <td><%= @prescription[0].dispense_type %> </td>
      </tr>
      </table>

    <% if @prescription[0].dispenses.have_dispense(@prescription[0].id).empty? %><!-- start check if patient already get dispense -->
       <% if !@prescription[0].dispense_profiles.dispensing_day(@prescription[0].id).empty? %>
        <!-- start dispense part -->
            <%= form_for @dispense, :url => {:action => 'create', :controller => 'dispenses', :patient_id => @patient.id} do |f| %>
              <%= f.hidden_field :prescription_id, :value => @prescription[0].id %>
              <%= f.hidden_field :date_of_dispense, :value => Time.now.to_date %>
              <%= f.hidden_field :no_of_dose, :value => @prescription[0].medicine_dose %>
              <%= f.submit "Dispense" %>
            <% end %>
        <!-- end dispense part -->

        <%= link_to 'Additional Dose', new_prescription_path(:patient_id => @patient.id), 'data-role'=>"button"%>
        <% end %>
        <% end %><!-- end part check if patient get dispense -->
    <% end %> <!-- end for checking prescription for this patient -->

    

    
      
    
  </div>
</div>
<br>
  </div> <!-- end data-content -->
<%=  render :partial=>'layouts/main_footer' %>

</div>
<% end %>